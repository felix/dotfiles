#!/bin/sh

hostname=$(hostname |cut -d. -f1)

# load resources, to be sure
[ -x "$(command -v xrdb)" ] && xrdb -merge "$HOME/.Xresources"

xset s off
xset -b
xsetroot -solid "#000000"

[ -f /etc/profile ] && . /etc/profile
[ -f "$HOME/.profile" ] && . $HOME/.profile

# Source local fonts too
[ -d ~/.fonts ] && xset +fp ~/.fonts/

# Add thai and lahu keyboards
#setxkbmap -I"$HOME/.xkb -option grp:shifts_toggle,grp_led:scroll" "us,th,lhu" -print |xkbcomp -I"$HOME/.xkb" - "$DISPLAY"

# XDG setup
[ ! -d /tmp/xdg-felix ] && mkdir -m 0700 /tmp/xdg-felix
export XDG_RUNTIME_DIR=/tmp/xdg-felix

# Qt theming
[ "$XDG_CURRENT_DESKTOP" = "KDE" ] || [ "$XDG_CURRENT_DESKTOP" = "GNOME" ] || export QT_QPA_PLATFORMTHEME="qt5ct"

[ -x "$(command -v redshift)" ] && redshift -m randr -t 5500:3500 -l -37.8023217:145.1144633 &

# Setup screens
[ -f "$HOME/.xsessionrc-$hostname" ] && "$HOME/.xsessionrc-$hostname"

# Screen control
if [ -x "$(command -v xautolock)" ]; then
    if [ -x "$(command -v xlock)" ]; then
        xautolock -time 5 -locker "xlock -modelist rain,space,pyro" &
    elif [ -x "$(command -v i3lock)" ]; then
        xautolock -time 5 -locker "i3lock -f -e -d -c 000000" &
    fi
fi

dbus-run-session pipewire &

[ -x "$(command -v alacritty)" ] && export TERMINAL=alacritty

# vim: set ft=sh :
